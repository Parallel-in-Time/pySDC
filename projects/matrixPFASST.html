<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Matrix-based versions of PFASST &#8212; pySDC 5.5.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css?v=2bf1fcf8" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c40552b6" />
    
    <script src="../_static/documentation_options.js?v=3005adad"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Second-order Problems" href="Hamiltonian.html" />
    <link rel="prev" title="Asymptotic convergence of PFASST" href="asymp_conv.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Hamiltonian.html" title="Second-order Problems"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="asymp_conv.html" title="Asymptotic convergence of PFASST"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pySDC 5.5.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Matrix-based versions of PFASST</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="matrix-based-versions-of-pfasst">
<h1>Matrix-based versions of PFASST<a class="headerlink" href="#matrix-based-versions-of-pfasst" title="Link to this heading">¶</a></h1>
<p>In this project, we use and test two matrix-based version of PFASST for linear problems:
we write PFASST as a standard twogrid method and we derive the propagaton matrix of PFASST.
Both approaches are compared to the standard multigrid controller of PFASST and with each other.
This includes tests with the heat, the advection as well as the test equation.</p>
<section id="matrix-based-pfasst">
<h2>Matrix-based PFASST<a class="headerlink" href="#matrix-based-pfasst" title="Link to this heading">¶</a></h2>
<p>When written as a multigrid method for a linear composite collocation problem, PFASST can be compactly defined via a
smoothing and a coarse-grid correction step, just as a standard two-grid method. In the new (and very specialized)
controller <code class="docutils literal notranslate"><span class="pre">allinclusive_matrix_nonMPI.py</span></code>, this concept is exploited to obtain a PFASST (and MLSDC and SDC)
controller closely resembling this idea and notation. In <code class="docutils literal notranslate"><span class="pre">compare_to_matrixbased.py</span></code>, this controller is tested
against the standard PFASST implementation.</p>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/projects/matrixPFASST/compare_to_matrixbased.py">pySDC/projects/matrixPFASST/compare_to_matrixbased.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.helpers.stats_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sorted</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.controller_classes.controller_nonMPI</span><span class="w"> </span><span class="kn">import</span> <span class="n">controller_nonMPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.AdvectionEquation_ND_FD</span><span class="w"> </span><span class="kn">import</span> <span class="n">advectionNd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.HeatEquation_ND_FD</span><span class="w"> </span><span class="kn">import</span> <span class="n">heatNd_unforced</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.TestEquation_0D</span><span class="w"> </span><span class="kn">import</span> <span class="n">testequation0d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.sweeper_classes.generic_implicit</span><span class="w"> </span><span class="kn">import</span> <span class="n">generic_implicit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.transfer_classes.TransferMesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">mesh_to_mesh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.transfer_classes.TransferMesh_NoCoarse</span><span class="w"> </span><span class="kn">import</span> <span class="n">mesh_to_mesh</span> <span class="k">as</span> <span class="n">mesh_to_mesh_nocoarse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.projects.matrixPFASST.controller_matrix_nonMPI</span><span class="w"> </span><span class="kn">import</span> <span class="n">controller_matrix_nonMPI</span>


<span class="k">def</span><span class="w"> </span><span class="nf">diffusion_setup</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup routine for advection test</span>

<span class="sd">    Args:</span>
<span class="sd">        par (float): parameter for controlling stiffness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-08</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LU&#39;</span>  <span class="c1"># For the IMEX sweeper, the LU-trick can be activated for the implicit part</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;initial_guess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spread&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span>  <span class="c1"># diffusion coefficient</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># frequency for the test value</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span> <span class="mi">63</span><span class="p">]</span>  <span class="c1"># number of degrees of freedom for each level</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dirichlet-zero&#39;</span>  <span class="c1"># boundary conditions</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;all_to_done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heatNd_unforced</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>  <span class="c1"># pass sweeper</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>  <span class="c1"># pass spatial transfer class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>  <span class="c1"># pass paramters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">advection_setup</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup routine for advection test</span>

<span class="sd">    Args:</span>
<span class="sd">        par (float): parameter for controlling stiffness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-08</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LU&#39;</span><span class="p">]</span>  <span class="c1"># For the IMEX sweeper, the LU-trick can be activated for the implicit part</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;initial_guess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spread&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># frequency for the test value</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>  <span class="c1"># number of degrees of freedom for each level</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;stencil_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;periodic&#39;</span>  <span class="c1"># boundary conditions</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;all_to_done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">advectionNd</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>  <span class="c1"># pass sweeper (see part B)</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>  <span class="c1"># pass spatial transfer class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>  <span class="c1"># pass paramters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">testequation_setup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup routine for the test equation</span>

<span class="sd">    Args:</span>
<span class="sd">        par (float): parameter for controlling stiffness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-08</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LU&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;initial_guess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spread&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;u0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># initial value (for all instances)</span>
    <span class="c1"># use single values like this...</span>
    <span class="c1"># problem_params[&#39;lambdas&#39;] = [[-1.0]]</span>
    <span class="c1"># .. or a list of values like this ...</span>
    <span class="c1"># problem_params[&#39;lambdas&#39;] = [[-1.0, -2.0, 1j, -1j]]</span>
    <span class="c1"># .. or a whole block of values like this</span>
    <span class="n">ilim_left</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span>
    <span class="n">ilim_right</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rlim_left</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rlim_right</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">ilam</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">ilim_left</span><span class="p">,</span> <span class="n">ilim_right</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    <span class="n">rlam</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">rlim_left</span><span class="p">,</span> <span class="n">rlim_right</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    <span class="n">lambdas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">rlam</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="n">ilam</span><span class="p">:</span>
            <span class="n">lambdas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rl</span> <span class="o">+</span> <span class="n">il</span><span class="p">)</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;lambdas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lambdas</span><span class="p">]</span>
    <span class="c1"># note: PFASST will do all of those at once, but without interaction (realized via diagonal matrix).</span>
    <span class="c1"># The propagation matrix will be diagonal too, corresponding to the respective lambda value.</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;all_to_done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testequation0d</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>  <span class="c1"># pass sweeper</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh_nocoarse</span>  <span class="c1"># pass spatial transfer class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># pass paramters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to compare PFASST runs with matrix-based and matrix-free controllers</span>

<span class="sd">    Args:</span>
<span class="sd">        type (str): setup type</span>
<span class="sd">        par (float) parameter for controlling stiffness</span>
<span class="sd">        f: file handler</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set time parameters</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Tend</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;diffusion&#39;</span><span class="p">:</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">diffusion_setup</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;advection&#39;</span><span class="p">:</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">advection_setup</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;testequation&#39;</span><span class="p">:</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">testequation_setup</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No valis setup type provided, aborting..&#39;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Working with </span><span class="si">%s</span><span class="s1"> setup and parameter </span><span class="si">%3.1e</span><span class="s1">..&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="c1"># instantiate controller</span>
    <span class="n">controller_mat</span> <span class="o">=</span> <span class="n">controller_matrix_nonMPI</span><span class="p">(</span><span class="n">num_procs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="n">controller_nomat</span> <span class="o">=</span> <span class="n">controller_nonMPI</span><span class="p">(</span><span class="n">num_procs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="c1"># get initial values on finest level</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">controller_nomat</span><span class="o">.</span><span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
    <span class="n">uinit</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
    <span class="n">uex</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">Tend</span><span class="p">)</span>

    <span class="c1"># this is where the iteration is happening</span>
    <span class="n">uend_mat</span><span class="p">,</span> <span class="n">stats_mat</span> <span class="o">=</span> <span class="n">controller_mat</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>
    <span class="n">uend_nomat</span><span class="p">,</span> <span class="n">stats_nomat</span> <span class="o">=</span> <span class="n">controller_nomat</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_mat</span> <span class="o">-</span> <span class="n">uend_nomat</span><span class="p">)</span>

    <span class="n">err_mat</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_mat</span> <span class="o">-</span> <span class="n">uex</span><span class="p">)</span>
    <span class="n">err_nomat</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_nomat</span> <span class="o">-</span> <span class="n">uex</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;  Error (mat/nomat) vs. exact solution: </span><span class="si">%6.4e</span><span class="s1"> -- </span><span class="si">%6.4e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">err_mat</span><span class="p">,</span> <span class="n">err_nomat</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;  Difference between both results: </span><span class="si">%6.4e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">diff</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mf">2.3e-15</span><span class="p">,</span> <span class="s1">&#39;ERROR: difference between matrix-based and matrix-free result is too large, got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">diff</span>

    <span class="c1"># get and convert statistics to list of iterations count, sorted by process</span>
    <span class="n">iter_counts_mat</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats_mat</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">iter_counts_nomat</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats_nomat</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;  Iteration counts for matrix-based version: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">iter_counts_mat</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;  Iteration counts for matrix-free version: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">iter_counts_nomat</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">iter_counts_nomat</span> <span class="o">==</span> <span class="n">iter_counts_mat</span>
    <span class="p">),</span> <span class="s1">&#39;ERROR: number of iterations differ between matrix-based and matrix-free controller&#39;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">par_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1e02</span><span class="p">]</span>

    <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/comparison_matrix_vs_nomat_detail.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">par_list</span><span class="p">:</span>
        <span class="n">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;diffusion&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="n">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;advection&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="n">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;testequation&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">Working</span> <span class="k">with</span> <span class="n">diffusion</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e-02</span><span class="o">..</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">nomat</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">4.0681e-07</span> <span class="o">--</span> <span class="mf">4.0681e-07</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">both</span> <span class="n">results</span><span class="p">:</span> <span class="mf">1.1102e-15</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">free</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">advection</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e-02</span><span class="o">..</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">nomat</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">2.0169e-04</span> <span class="o">--</span> <span class="mf">2.0169e-04</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">both</span> <span class="n">results</span><span class="p">:</span> <span class="mf">4.4409e-16</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">free</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">diffusion</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+00</span><span class="o">..</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">nomat</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">5.8573e-06</span> <span class="o">--</span> <span class="mf">5.8573e-06</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">both</span> <span class="n">results</span><span class="p">:</span> <span class="mf">2.1781e-18</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">free</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">advection</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+00</span><span class="o">..</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">nomat</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">2.9363e-01</span> <span class="o">--</span> <span class="mf">2.9363e-01</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">both</span> <span class="n">results</span><span class="p">:</span> <span class="mf">1.4433e-15</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">free</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">diffusion</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+02</span><span class="o">..</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">nomat</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">3.2887e-13</span> <span class="o">--</span> <span class="mf">3.2887e-13</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">both</span> <span class="n">results</span><span class="p">:</span> <span class="mf">9.7511e-22</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">free</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">advection</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+02</span><span class="o">..</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">nomat</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">1.0000e+00</span> <span class="o">--</span> <span class="mf">1.0000e+00</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">both</span> <span class="n">results</span><span class="p">:</span> <span class="mf">4.3996e-17</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">free</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">testequation</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">0.0e+00</span><span class="o">..</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">nomat</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">5.7992e-06</span> <span class="o">--</span> <span class="mf">5.7992e-06</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">both</span> <span class="n">results</span><span class="p">:</span> <span class="mf">5.0019e-16</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">free</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="propagator-based-pfasst">
<h2>Propagator-based PFASST<a class="headerlink" href="#propagator-based-pfasst" title="Link to this heading">¶</a></h2>
<p>The second approach follows directly from the matrix formulation: instead of writing PFASST as an iterative scheme,
we now derive the full propagation matrix, which takes the initial value u0 and produces the final value uend,
over all steps, iterations and sweeps. This matrix can be used to analyze PFASST in yet another exciting way.</p>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/projects/matrixPFASST/compare_to_propagator.py">pySDC/projects/matrixPFASST/compare_to_propagator.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.helpers.stats_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sorted</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.AdvectionEquation_ND_FD</span><span class="w"> </span><span class="kn">import</span> <span class="n">advectionNd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.HeatEquation_ND_FD</span><span class="w"> </span><span class="kn">import</span> <span class="n">heatNd_unforced</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.TestEquation_0D</span><span class="w"> </span><span class="kn">import</span> <span class="n">testequation0d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.sweeper_classes.generic_implicit</span><span class="w"> </span><span class="kn">import</span> <span class="n">generic_implicit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.transfer_classes.TransferMesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">mesh_to_mesh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.transfer_classes.TransferMesh_NoCoarse</span><span class="w"> </span><span class="kn">import</span> <span class="n">mesh_to_mesh</span> <span class="k">as</span> <span class="n">mesh_to_mesh_nocoarse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.projects.matrixPFASST.controller_matrix_nonMPI</span><span class="w"> </span><span class="kn">import</span> <span class="n">controller_matrix_nonMPI</span>


<span class="k">def</span><span class="w"> </span><span class="nf">diffusion_setup</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup routine for advection test</span>

<span class="sd">    Args:</span>
<span class="sd">        par (float): parameter for controlling stiffness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-08</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LU&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;initial_guess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spread&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span>  <span class="c1"># diffusion coefficient</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># frequency for the test value</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">127</span><span class="p">]</span>  <span class="c1"># number of degrees of freedom for each level</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dirichlet-zero&#39;</span>  <span class="c1"># boundary conditions</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heatNd_unforced</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>  <span class="c1"># pass sweeper</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>  <span class="c1"># pass spatial transfer class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>  <span class="c1"># pass paramters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">advection_setup</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup routine for advection test</span>

<span class="sd">    Args:</span>
<span class="sd">        par (float): parameter for controlling stiffness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-08</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LU&#39;</span><span class="p">]</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;initial_guess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spread&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># frequency for the test value</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>  <span class="c1"># number of degrees of freedom for each level</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;stencil_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;periodic&#39;</span>  <span class="c1"># boundary conditions</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">advectionNd</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>  <span class="c1"># pass sweeper (see part B)</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>  <span class="c1"># pass spatial transfer class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>  <span class="c1"># pass paramters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">scalar_equation_setup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup routine for the test equation</span>

<span class="sd">    Args:</span>
<span class="sd">        par (float): parameter for controlling stiffness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-08</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LU&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;initial_guess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spread&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;u0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># initial value (for all instances)</span>
    <span class="c1"># use single values like this...</span>
    <span class="c1"># problem_params[&#39;lambdas&#39;] = [[-1.0]]</span>
    <span class="c1"># .. or a list of values like this ...</span>
    <span class="c1"># problem_params[&#39;lambdas&#39;] = [[-1.0, -2.0, 1j, -1j]]</span>
    <span class="c1"># .. or a whole block of values like this</span>
    <span class="n">ilim_left</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span>
    <span class="n">ilim_right</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rlim_left</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rlim_right</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">ilam</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">ilim_left</span><span class="p">,</span> <span class="n">ilim_right</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    <span class="n">rlam</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">rlim_left</span><span class="p">,</span> <span class="n">rlim_right</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    <span class="n">lambdas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">rlam</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="n">ilam</span><span class="p">:</span>
            <span class="n">lambdas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rl</span> <span class="o">+</span> <span class="n">il</span><span class="p">)</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;lambdas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lambdas</span><span class="p">]</span>
    <span class="c1"># note: PFASST will do all of those at once, but without interaction (realized via diagonal matrix).</span>
    <span class="c1"># The propagation matrix will be diagonal too, corresponding to the respective lambda value.</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testequation0d</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>  <span class="c1"># pass sweeper</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh_nocoarse</span>  <span class="c1"># pass spatial transfer class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># pass paramters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to compare PFASST runs with matrix-based and matrix-free controllers</span>

<span class="sd">    Args:</span>
<span class="sd">        type (str): setup type</span>
<span class="sd">        par (float): parameter for controlling stiffness</span>
<span class="sd">        f: file handler</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set time parameters</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Tend</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;diffusion&#39;</span><span class="p">:</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">diffusion_setup</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;advection&#39;</span><span class="p">:</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">advection_setup</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;testequation&#39;</span><span class="p">:</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">scalar_equation_setup</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No valis setup type provided, aborting..&#39;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Working with </span><span class="si">%s</span><span class="s1"> setup and parameter </span><span class="si">%3.1e</span><span class="s1">..&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="c1"># instantiate controller</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">controller_matrix_nonMPI</span><span class="p">(</span><span class="n">num_procs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="c1"># get initial values on finest level</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
    <span class="n">uinit</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
    <span class="n">uex</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">Tend</span><span class="p">)</span>

    <span class="c1"># this is where the iteration is happening</span>
    <span class="n">uend_mat</span><span class="p">,</span> <span class="n">stats_mat</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>

    <span class="c1"># filter statistics by type (number of iterations)</span>
    <span class="n">iter_counts_mat</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats_mat</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;  Iteration counts for matrix-based version: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">iter_counts_mat</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="c1"># filter only iteration counts and check for equality</span>
    <span class="n">niters</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_counts_mat</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">niters</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">niters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">niters</span><span class="p">),</span> <span class="s1">&#39;ERROR: not all time-steps have the same number of iterations&#39;</span>
    <span class="n">niter</span> <span class="o">=</span> <span class="n">niters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># build propagation matrix using the prescribed number of iterations (or any other, if needed)</span>
    <span class="n">prop</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">build_propagation_matrix</span><span class="p">(</span><span class="n">niter</span><span class="o">=</span><span class="n">niter</span><span class="p">)</span>

    <span class="n">err_prop_ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">uinit</span><span class="p">)</span> <span class="o">-</span> <span class="n">uex</span><span class="p">)</span>
    <span class="n">err_mat_ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">uend_mat</span> <span class="o">-</span> <span class="n">uex</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;  Error (mat/prop) vs. exact solution: </span><span class="si">%6.4e</span><span class="s1"> -- </span><span class="si">%6.4e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">err_mat_ex</span><span class="p">,</span> <span class="n">err_prop_ex</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">err_mat_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">uinit</span><span class="p">)</span> <span class="o">-</span> <span class="n">uend_mat</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;  Difference between matrix-PFASST and propagator: </span><span class="si">%6.4e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_mat_prop</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">err_mat_prop</span> <span class="o">&lt;</span> <span class="mf">2.0e-14</span><span class="p">,</span> <span class="p">(</span>
        <span class="s1">&#39;ERROR: difference between matrix-based and propagator result is too large, got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_mat_prop</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">par_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1e02</span><span class="p">]</span>

    <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/comparison_matrix_vs_propagator_detail.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">par_list</span><span class="p">:</span>
        <span class="n">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;diffusion&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="n">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;advection&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="n">compare_controllers</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;testequation&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">Working</span> <span class="k">with</span> <span class="n">diffusion</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e-02</span><span class="o">..</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">prop</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">3.2542e-06</span> <span class="o">--</span> <span class="mf">3.2542e-06</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">matrix</span><span class="o">-</span><span class="n">PFASST</span> <span class="ow">and</span> <span class="n">propagator</span><span class="p">:</span> <span class="mf">3.0509e-15</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">advection</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e-02</span><span class="o">..</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">prop</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">1.6141e-03</span> <span class="o">--</span> <span class="mf">1.6141e-03</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">matrix</span><span class="o">-</span><span class="n">PFASST</span> <span class="ow">and</span> <span class="n">propagator</span><span class="p">:</span> <span class="mf">1.7400e-15</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">diffusion</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+00</span><span class="o">..</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">prop</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">4.6858e-05</span> <span class="o">--</span> <span class="mf">4.6858e-05</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">matrix</span><span class="o">-</span><span class="n">PFASST</span> <span class="ow">and</span> <span class="n">propagator</span><span class="p">:</span> <span class="mf">9.2885e-18</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">advection</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+00</span><span class="o">..</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">prop</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">2.3515e+00</span> <span class="o">--</span> <span class="mf">2.3515e+00</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">matrix</span><span class="o">-</span><span class="n">PFASST</span> <span class="ow">and</span> <span class="n">propagator</span><span class="p">:</span> <span class="mf">3.8462e-15</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">diffusion</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+02</span><span class="o">..</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">prop</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">2.6312e-12</span> <span class="o">--</span> <span class="mf">2.6312e-12</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">matrix</span><span class="o">-</span><span class="n">PFASST</span> <span class="ow">and</span> <span class="n">propagator</span><span class="p">:</span> <span class="mf">9.8449e-21</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">advection</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">1.0e+02</span><span class="o">..</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">prop</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">8.0000e+00</span> <span class="o">--</span> <span class="mf">8.0000e+00</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">matrix</span><span class="o">-</span><span class="n">PFASST</span> <span class="ow">and</span> <span class="n">propagator</span><span class="p">:</span> <span class="mf">8.4603e-16</span>

<span class="n">Working</span> <span class="k">with</span> <span class="n">testequation</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="mf">0.0e+00</span><span class="o">..</span>
  <span class="n">Iteration</span> <span class="n">counts</span> <span class="k">for</span> <span class="n">matrix</span><span class="o">-</span><span class="n">based</span> <span class="n">version</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
  <span class="n">Error</span> <span class="p">(</span><span class="n">mat</span><span class="o">/</span><span class="n">prop</span><span class="p">)</span> <span class="n">vs</span><span class="o">.</span> <span class="n">exact</span> <span class="n">solution</span><span class="p">:</span> <span class="mf">2.0384e-05</span> <span class="o">--</span> <span class="mf">2.0384e-05</span>
  <span class="n">Difference</span> <span class="n">between</span> <span class="n">matrix</span><span class="o">-</span><span class="n">PFASST</span> <span class="ow">and</span> <span class="n">propagator</span><span class="p">:</span> <span class="mf">3.4674e-16</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Matrix-based versions of PFASST</a><ul>
<li><a class="reference internal" href="#matrix-based-pfasst">Matrix-based PFASST</a></li>
<li><a class="reference internal" href="#propagator-based-pfasst">Propagator-based PFASST</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="asymp_conv.html"
                          title="previous chapter">Asymptotic convergence of PFASST</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Hamiltonian.html"
                          title="next chapter">Second-order Problems</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/projects/matrixPFASST.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Hamiltonian.html" title="Second-order Problems"
             >next</a> |</li>
        <li class="right" >
          <a href="asymp_conv.html" title="Asymptotic convergence of PFASST"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pySDC 5.5.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Matrix-based versions of PFASST</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Robert Speck.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>