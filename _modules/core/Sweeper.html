
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>core.Sweeper &#8212; pySDC 4.2.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pySDC 4.2.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">core.Sweeper</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for core.Sweeper</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>

<span class="kn">from</span> <span class="nn">pySDC.core.Errors</span> <span class="kn">import</span> <span class="n">ParameterError</span>
<span class="kn">from</span> <span class="nn">pySDC.core.Level</span> <span class="kn">import</span> <span class="n">level</span>
<span class="kn">from</span> <span class="nn">pySDC.helpers.pysdc_helper</span> <span class="kn">import</span> <span class="n">FrozenClass</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.collocation_classes.equidistant_right</span> <span class="kn">import</span> <span class="n">EquidistantNoLeft</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.collocation_classes.gauss_lobatto</span> <span class="kn">import</span> <span class="n">CollGaussLobatto</span>
<span class="kn">from</span> <span class="nn">pySDC.implementations.collocation_classes.gauss_radau_right</span> <span class="kn">import</span> <span class="n">CollGaussRadau_Right</span>


<span class="c1"># short helper class to add params as attributes</span>
<span class="k">class</span> <span class="nc">_Pars</span><span class="p">(</span><span class="n">FrozenClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_coll_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="s1">&#39;spread&#39;</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;collocation_class&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_freeze</span><span class="p">()</span>


<div class="viewcode-block" id="sweeper"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper">[docs]</a><span class="k">class</span> <span class="nc">sweeper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base abstract sweeper class</span>

<span class="sd">    Attributes:</span>
<span class="sd">        logger: custom logger for sweeper-related logging</span>
<span class="sd">        params (__Pars): parameter object containing the custom parameters passed by the user</span>
<span class="sd">        coll (pySDC.Collocation.CollBase): collocation object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization routine for the base sweeper</span>

<span class="sd">        Args:</span>
<span class="sd">            params (dict): parameter object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># set up logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;sweeper&#39;</span><span class="p">)</span>

        <span class="n">essential_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;collocation_class&#39;</span><span class="p">,</span> <span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">essential_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;need </span><span class="si">%s</span><span class="s1"> to instantiate step, only got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">_Pars</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">coll</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;collocation_class&#39;</span><span class="p">](</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">coll</span><span class="o">.</span><span class="n">right_is_node</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">do_coll_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;we need to do a collocation update here, since the right end point is not a node. &#39;</span>
                                <span class="s1">&#39;Changing this!&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">do_coll_update</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># This will be set as soon as the sweeper is instantiated at the level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__level</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># collocation object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coll</span> <span class="o">=</span> <span class="n">coll</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parallelizable</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="sweeper.get_Qdelta_implicit"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper.get_Qdelta_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">get_Qdelta_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coll</span><span class="p">,</span> <span class="n">qd_type</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">rho</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]))))</span>

        <span class="n">QDmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;LU&#39;</span><span class="p">:</span>
            <span class="n">QT</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">T</span>
            <span class="p">[</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">U</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lu</span><span class="p">(</span><span class="n">QT</span><span class="p">,</span> <span class="n">overwrite_a</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">QDmat</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;LU2&#39;</span><span class="p">:</span>
            <span class="n">QT</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">T</span>
            <span class="p">[</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">U</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lu</span><span class="p">(</span><span class="n">QT</span><span class="p">,</span> <span class="n">overwrite_a</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">QDmat</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">U</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;TRAP&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">QDmat</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">delta_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">QDmat</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coll</span><span class="o">.</span><span class="n">delta_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span>
            <span class="n">QDmat</span> <span class="o">/=</span> <span class="mf">2.0</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;IE&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">QDmat</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">delta_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;IEpar&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">QDmat</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">delta_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallelizable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;Qpar&#39;</span><span class="p">:</span>
            <span class="n">QDmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallelizable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;GS&#39;</span><span class="p">:</span>
            <span class="n">QDmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;PIC&#39;</span><span class="p">:</span>
            <span class="n">QDmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallelizable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;MIN&#39;</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">QDmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">)</span>
            <span class="n">QDmat</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallelizable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;MIN3&#39;</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">QDmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># These values have been obtained using Indie Solver, a commercial solver for black-box optimization which</span>
            <span class="c1"># aggregates several state-of-the-art optimization methods (free academic subscription plan)</span>
            <span class="c1"># objective function: sum over 17^2 values of lamdt, real and imaginary (WORKS SURPRISINGLY WELL!)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span> <span class="o">==</span> <span class="n">CollGaussLobatto</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                    <span class="c1"># rho = 0.154786693955</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.14748983547536937</span><span class="p">,</span> <span class="mf">0.1243753767395874</span><span class="p">,</span> <span class="mf">0.08797965969063823</span><span class="p">,</span> <span class="mf">0.03249792877433364</span><span class="p">,</span>
                         <span class="mf">0.06171633442251176</span><span class="p">,</span> <span class="mf">0.08995295998705832</span><span class="p">,</span> <span class="mf">0.1080641868728824</span><span class="p">,</span> <span class="mf">0.11621787232558443</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0979351256833</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.18827968699454273</span><span class="p">,</span> <span class="mf">0.1307213945012976</span><span class="p">,</span> <span class="mf">0.04545003319140543</span><span class="p">,</span> <span class="mf">0.08690617895312261</span><span class="p">,</span>
                         <span class="mf">0.12326429119922168</span><span class="p">,</span> <span class="mf">0.13815746843252427</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0513543155235</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2994085231050721</span><span class="p">,</span> <span class="mf">0.07923154575177252</span><span class="p">,</span> <span class="mf">0.14338847088077</span><span class="p">,</span> <span class="mf">0.17675509273708057</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0381589713397</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2865524188780046</span><span class="p">,</span> <span class="mf">0.11264992497015984</span><span class="p">,</span> <span class="mf">0.2583063168320655</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># rho = 0.013592619664</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2113181799416633</span><span class="p">,</span> <span class="mf">0.3943250920445912</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># rho = 0</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This combination of preconditioner, node type and node number is not &#39;</span>
                                        <span class="s1">&#39;implemented&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span> <span class="o">==</span> <span class="n">CollGaussRadau_Right</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                    <span class="c1"># rho = 0.151784861385</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.14208076083211416</span><span class="p">,</span> <span class="mf">0.1288153963623986</span><span class="p">,</span> <span class="mf">0.10608601069476883</span><span class="p">,</span> <span class="mf">0.07509520272252024</span><span class="p">,</span>
                         <span class="mf">0.027986167728305308</span><span class="p">,</span> <span class="mf">0.05351160749903067</span><span class="p">,</span> <span class="mf">0.07911315989747868</span><span class="p">,</span> <span class="mf">0.09514844658836666</span><span class="p">,</span>
                         <span class="mf">0.10204992319487571</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="c1"># rho = 0.116400161888</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.15223871397682717</span><span class="p">,</span> <span class="mf">0.12625448001038536</span><span class="p">,</span> <span class="mf">0.08210714764924298</span><span class="p">,</span> <span class="mf">0.03994434742760019</span><span class="p">,</span>
                         <span class="mf">0.1052662547386142</span><span class="p">,</span> <span class="mf">0.14075805578834127</span><span class="p">,</span> <span class="mf">0.15636085758812895</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0783352996958 (iteration 5355)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2818591930905709</span><span class="p">,</span> <span class="mf">0.2011358490453793</span><span class="p">,</span> <span class="mf">0.06274536689514164</span><span class="p">,</span> <span class="mf">0.11790265267514095</span><span class="p">,</span>
                         <span class="mf">0.1571629578515223</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="c1"># rho = 0.057498908343</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3198786751412953</span><span class="p">,</span> <span class="mf">0.08887606314792469</span><span class="p">,</span> <span class="mf">0.1812366328324738</span><span class="p">,</span> <span class="mf">0.23273925017954</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># rho = 0.038744192979 (iteration 11188)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3203856825077055</span><span class="p">,</span> <span class="mf">0.1399680686269595</span><span class="p">,</span> <span class="mf">0.3716708461097372</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0208560702294 (iteration 6690)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2584092406077449</span><span class="p">,</span> <span class="mf">0.6449261740461826</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This combination of preconditioner, node type and node number is not &#39;</span>
                                        <span class="s1">&#39;implemented&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span> <span class="o">==</span> <span class="n">EquidistantNoLeft</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                    <span class="c1"># rho = 0.251820022583 (iteration 32402)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.04067333763109274</span><span class="p">,</span> <span class="mf">0.06893408176924318</span><span class="p">,</span> <span class="mf">0.0944460427779633</span><span class="p">,</span> <span class="mf">0.11847528720123894</span><span class="p">,</span>
                         <span class="mf">0.14153236351607695</span><span class="p">,</span> <span class="mf">0.1638856774260845</span><span class="p">,</span> <span class="mf">0.18569759470199648</span><span class="p">,</span> <span class="mf">0.20707543960267513</span><span class="p">,</span>
                         <span class="mf">0.2280946565716198</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="c1"># rho = 0.184582997611 (iteration 44871)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0582690792096515</span><span class="p">,</span> <span class="mf">0.09937620459067688</span><span class="p">,</span> <span class="mf">0.13668728443669567</span><span class="p">,</span> <span class="mf">0.1719458323664216</span><span class="p">,</span>
                         <span class="mf">0.20585615258818232</span><span class="p">,</span> <span class="mf">0.2387890485242656</span><span class="p">,</span> <span class="mf">0.27096908017041393</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="c1"># rho = 0.118441339197 (iteration 34581)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0937126798932547</span><span class="p">,</span> <span class="mf">0.1619131388001843</span><span class="p">,</span> <span class="mf">0.22442341539247537</span><span class="p">,</span> <span class="mf">0.28385142992912565</span><span class="p">,</span>
                         <span class="mf">0.3412523013467262</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0844043254542 (iteration 33099)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.13194852204686872</span><span class="p">,</span> <span class="mf">0.2296718892453916</span><span class="p">,</span> <span class="mf">0.3197255970017318</span><span class="p">,</span> <span class="mf">0.405619746972393</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0504635143866 (iteration 9783)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2046955744931575</span><span class="p">,</span> <span class="mf">0.3595744268324041</span><span class="p">,</span> <span class="mf">0.5032243650307717</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># rho = 0.0214806480623 (iteration 6109)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3749891032632652</span><span class="p">,</span> <span class="mf">0.6666472946796036</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This combination of preconditioner, node type and node number is not &#39;</span>
                                        <span class="s1">&#39;implemented&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This combination of preconditioner, node type and node number is not &#39;</span>
                                    <span class="s1">&#39;implemented&#39;</span><span class="p">)</span>
            <span class="n">QDmat</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallelizable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;qd_type implicit not implemented&#39;</span><span class="p">)</span>
        <span class="c1"># check if we got not more than a lower triangular matrix</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">QDmat</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">QDmat</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                      <span class="n">err_msg</span><span class="o">=</span><span class="s1">&#39;Lower triangular matrix expected!&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">QDmat</span></div>

<div class="viewcode-block" id="sweeper.get_Qdelta_explicit"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper.get_Qdelta_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">get_Qdelta_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coll</span><span class="p">,</span> <span class="n">qd_type</span><span class="p">):</span>
        <span class="n">QDmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;EE&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">QDmat</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">delta_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;GS&#39;</span><span class="p">:</span>
            <span class="n">QDmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="p">,</span> <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">qd_type</span> <span class="o">==</span> <span class="s1">&#39;PIC&#39;</span><span class="p">:</span>
            <span class="n">QDmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Qmat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;qd_type explicit not implemented&#39;</span><span class="p">)</span>

        <span class="c1"># check if we got not more than a lower triangular matrix</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">QDmat</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">QDmat</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                      <span class="n">err_msg</span><span class="o">=</span><span class="s1">&#39;Strictly lower triangular matrix expected!&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">QDmat</span></div>

<div class="viewcode-block" id="sweeper.predict"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predictor to fill values at nodes before first sweep</span>

<span class="sd">        Default prediction for the sweepers, only copies the values to all collocation nodes</span>
<span class="sd">        and evaluates the RHS of the ODE there</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get current level and problem description</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">prob</span>

        <span class="c1"># evaluate RHS at left point</span>
        <span class="n">L</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">eval_f</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">L</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># copy u[0] to all collocation nodes, evaluate RHS</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s1">&#39;spread&#39;</span><span class="p">:</span>
                <span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">dtype_u</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">L</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">eval_f</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">L</span><span class="o">.</span><span class="n">time</span> <span class="o">+</span> <span class="n">L</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="c1"># start with zero everywhere</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s1">&#39;zero&#39;</span><span class="p">:</span>
                <span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">dtype_u</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">L</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">dtype_f</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;initial_guess option </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">initial_guess</span><span class="si">}</span><span class="s1"> not implemented&#39;</span><span class="p">)</span>

        <span class="c1"># indicate that this level is now ready for sweeps</span>
        <span class="n">L</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">unlocked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">L</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="sweeper.compute_residual"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper.compute_residual">[docs]</a>    <span class="k">def</span> <span class="nf">compute_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computation of the residual using the collocation matrix Q</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get current level and problem description</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span>

        <span class="c1"># check if there are new values (e.g. from a sweep)</span>
        <span class="c1"># assert L.status.updated</span>

        <span class="c1"># compute the residual for each node</span>

        <span class="c1"># build QF(u)</span>
        <span class="n">res_norm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># add tau if associated</span>
            <span class="k">if</span> <span class="n">L</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">L</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
            <span class="c1"># use abs function from data type here</span>
            <span class="n">res_norm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>

        <span class="c1"># find maximal residual over the nodes</span>
        <span class="k">if</span> <span class="n">L</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">residual_type</span> <span class="o">==</span> <span class="s1">&#39;full_abs&#39;</span><span class="p">:</span>
            <span class="n">L</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">res_norm</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">L</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">residual_type</span> <span class="o">==</span> <span class="s1">&#39;last_abs&#39;</span><span class="p">:</span>
            <span class="n">L</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="n">res_norm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">L</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">residual_type</span> <span class="o">==</span> <span class="s1">&#39;full_rel&#39;</span><span class="p">:</span>
            <span class="n">L</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">res_norm</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">L</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">residual_type</span> <span class="o">==</span> <span class="s1">&#39;last_rel&#39;</span><span class="p">:</span>
            <span class="n">L</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="n">res_norm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;residual_type = </span><span class="si">{</span><span class="n">L</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">residual_type</span><span class="si">}</span><span class="s1"> not implemented, choose &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;full_abs, last_abs, full_rel or last_rel instead&#39;</span><span class="p">)</span>

        <span class="c1"># indicate that the residual has seen the new values</span>
        <span class="n">L</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="sweeper.compute_end_point"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper.compute_end_point">[docs]</a>    <span class="k">def</span> <span class="nf">compute_end_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract interface to end-node computation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;ERROR: sweeper has to implement compute_end_point(self)&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="sweeper.integrate"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper.integrate">[docs]</a>    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract interface to right-hand side integration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;ERROR: sweeper has to implement integrate(self)&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="sweeper.update_nodes"><a class="viewcode-back" href="../../pySDC/core.html#core.Sweeper.sweeper.update_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">update_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract interface to node update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;ERROR: sweeper has to implement update_nodes(self)&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current level</span>

<span class="sd">        Returns:</span>
<span class="sd">            pySDC.Level.level: the current level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__level</span>

    <span class="nd">@level</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a reference to the current level (done in the initialization of the level)</span>

<span class="sd">        Args:</span>
<span class="sd">            L (pySDC.Level.level): current level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__level</span> <span class="o">=</span> <span class="n">L</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pySDC 4.2.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">core.Sweeper</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Robert Speck.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>