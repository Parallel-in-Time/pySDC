<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Step-8: Advanced topics &#8212; pySDC 5.6 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css?v=2bf1fcf8" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c40552b6" />
    
    <script src="../_static/documentation_options.js?v=81710850"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Attempts to parallelize SDC" href="../projects/parallelSDC.html" />
    <link rel="prev" title="Step-7: pySDC with external libraries" href="step_7.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../projects/parallelSDC.html" title="Attempts to parallelize SDC"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="step_7.html" title="Step-7: pySDC with external libraries"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pySDC 5.6 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Step-8: Advanced topics</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="step-8-advanced-topics">
<h1>Step-8: Advanced topics<a class="headerlink" href="#step-8-advanced-topics" title="Link to this heading">¶</a></h1>
<p>Since we now have explored the basic features of pySDC, we are actually ready to do some serious science (e.g. in the projects).
However, we gather here further interesting cases, e.g. special flags or more alternative implementations of components.</p>
<section id="part-a-visualizing-residuals">
<h2>Part A: Visualizing Residuals<a class="headerlink" href="#part-a-visualizing-residuals" title="Link to this heading">¶</a></h2>
<p>In this part, we briefly introduce the visualization of residuals, built in into pySDC’s plugins.
The application is (supposed) to be simple: merely put the <code class="docutils literal notranslate"><span class="pre">stats</span></code> object into the function <code class="docutils literal notranslate"><span class="pre">show_residual_across_simulation</span></code> and look at the resulting figure.</p>
<p>Important things to note:</p>
<ul class="simple">
<li><p>The function visualizes simply the residuals over all processes and all iterations, but only for a single block.</p></li>
<li><p>The function itself is pretty straightforward and does not require passing the number of processes or iterations.</p></li>
</ul>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/tutorial/step_8/A_visualize_residuals.py">pySDC/tutorial/step_8/A_visualize_residuals.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.helpers.stats_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sorted</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.helpers.visualization_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_residual_across_simulation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.controller_classes.controller_nonMPI</span><span class="w"> </span><span class="kn">import</span> <span class="n">controller_nonMPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.tutorial.step_6.A_run_non_MPI_controller</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_parameters_ml</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to demonstrate residual visualization</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get parameters from Step 6, Part A</span>
    <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span> <span class="o">=</span> <span class="n">set_parameters_ml</span><span class="p">()</span>

    <span class="c1"># use 8 processes here</span>
    <span class="n">num_proc</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="c1"># instantiate controller</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">controller_nonMPI</span><span class="p">(</span><span class="n">num_procs</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="c1"># get initial values on finest level</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
    <span class="n">uinit</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>

    <span class="c1"># call main function to get things done...</span>
    <span class="n">uend</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>

    <span class="c1"># compute exact solution and compare (for testing purposes only)</span>
    <span class="n">uex</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">Tend</span><span class="p">)</span>
    <span class="n">err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend</span><span class="p">)</span>

    <span class="c1"># filter statistics by type (number of iterations)</span>
    <span class="n">iter_counts</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># compute and print statistics</span>
    <span class="n">min_iter</span> <span class="o">=</span> <span class="mi">99</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/step_8_A_out.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_counts</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Number of iterations for time </span><span class="si">%4.2f</span><span class="s1">: </span><span class="si">%1i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">item</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">min_iter</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_iter</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># call helper routine to produce residual plot</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;data/step_8_residuals.png&#39;</span>
    <span class="n">show_residual_across_simulation</span><span class="p">(</span><span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="mf">6.1555e-05</span><span class="p">,</span> <span class="s1">&#39;ERROR: error is too large, got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="s1">&#39;ERROR: residual plot has not been created&#39;</span>
    <span class="k">assert</span> <span class="n">min_iter</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">and</span> <span class="n">max_iter</span> <span class="o">==</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;ERROR: number of iterations not as expected, got </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">min_iter</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span><span class="p">:</span> <span class="mi">7</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/step_8_residuals.png"><img alt="../_images/step_8_residuals.png" src="../_images/step_8_residuals.png" style="width: 754.0px; height: 505.5px;" />
</a>
</section>
<section id="part-b-multi-step-sdc">
<h2>Part B: Multi-step SDC<a class="headerlink" href="#part-b-multi-step-sdc" title="Link to this heading">¶</a></h2>
<p>One interesting question when playing around with the different configurations is this: what happens, if we want parallel time-steps but only a single level?
The result is called multi-step SDC. Here, after each sweep the result is sent forward, but is picked up in the next (and not current) iteration.
This corresponds to performing only the smoother stage in a multigrid scheme.
Parallelization is dead-simple and no coarsening strategy is needed.
Yet, the missing stabilization of the coarse level leads to a significant increase in iterations, when more time-steps are computed in parallel.
To prevent this, information can be sent forward immediately, but then this is not a parallel algorithm anymore..</p>
<p>Important things to note:</p>
<ul class="simple">
<li><p>Use the controller parameter <code class="docutils literal notranslate"><span class="pre">mssdc_jac</span></code> to control whether the method should be “parallel” (Jacobi-like) or “serial” (Gauss-like).</p></li>
<li><p>We increased the logging value here again, (safely) ignoring the warnings for multi-step SDC.</p></li>
</ul>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/tutorial/step_8/B_multistep_SDC.py">pySDC/tutorial/step_8/B_multistep_SDC.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.helpers.stats_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sorted</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.helpers.visualization_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_residual_across_simulation</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.controller_classes.controller_nonMPI</span><span class="w"> </span><span class="kn">import</span> <span class="n">controller_nonMPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.HeatEquation_ND_FD</span><span class="w"> </span><span class="kn">import</span> <span class="n">heatNd_unforced</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.sweeper_classes.generic_implicit</span><span class="w"> </span><span class="kn">import</span> <span class="n">generic_implicit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.transfer_classes.TransferMesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">mesh_to_mesh</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to do compare PFASST with multi-step SDC</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5e-10</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.125</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LU&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># diffusion coefficient</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># frequency for the test value</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dirichlet-zero&#39;</span>  <span class="c1"># boundary conditions</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heatNd_unforced</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>

    <span class="c1"># set up parameters for PFASST run</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">63</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">description_pfasst</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># set up parameters for MSSDC run</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">63</span><span class="p">]</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">description_mssdc</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;mssdc_jac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">controller_params_jac</span> <span class="o">=</span> <span class="n">controller_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;mssdc_jac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">controller_params_gs</span> <span class="o">=</span> <span class="n">controller_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># set time parameters</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Tend</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># set up list of parallel time-steps to run PFASST/MSSDC with</span>
    <span class="n">num_proc</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="c1"># instantiate controllers</span>
    <span class="n">controller_mssdc_jac</span> <span class="o">=</span> <span class="n">controller_nonMPI</span><span class="p">(</span>
        <span class="n">num_procs</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params_jac</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description_mssdc</span>
    <span class="p">)</span>
    <span class="n">controller_mssdc_gs</span> <span class="o">=</span> <span class="n">controller_nonMPI</span><span class="p">(</span>
        <span class="n">num_procs</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params_gs</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description_mssdc</span>
    <span class="p">)</span>
    <span class="n">controller_pfasst</span> <span class="o">=</span> <span class="n">controller_nonMPI</span><span class="p">(</span>
        <span class="n">num_procs</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description_pfasst</span>
    <span class="p">)</span>

    <span class="c1"># get initial values on finest level</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">controller_mssdc_jac</span><span class="o">.</span><span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
    <span class="n">uinit</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>

    <span class="c1"># call main functions to get things done...</span>
    <span class="n">uend_pfasst</span><span class="p">,</span> <span class="n">stats_pfasst</span> <span class="o">=</span> <span class="n">controller_pfasst</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>
    <span class="n">uend_mssdc_jac</span><span class="p">,</span> <span class="n">stats_mssdc_jac</span> <span class="o">=</span> <span class="n">controller_mssdc_jac</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>
    <span class="n">uend_mssdc_gs</span><span class="p">,</span> <span class="n">stats_mssdc_gs</span> <span class="o">=</span> <span class="n">controller_mssdc_gs</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>

    <span class="c1"># compute exact solution and compare for both runs</span>
    <span class="n">uex</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">Tend</span><span class="p">)</span>
    <span class="n">err_mssdc_jac</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend_mssdc_jac</span><span class="p">)</span>
    <span class="n">err_mssdc_gs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend_mssdc_gs</span><span class="p">)</span>
    <span class="n">err_pfasst</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uex</span> <span class="o">-</span> <span class="n">uend_pfasst</span><span class="p">)</span>
    <span class="n">diff_jac</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_mssdc_jac</span> <span class="o">-</span> <span class="n">uend_pfasst</span><span class="p">)</span>
    <span class="n">diff_gs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_mssdc_gs</span> <span class="o">-</span> <span class="n">uend_pfasst</span><span class="p">)</span>
    <span class="n">diff_jac_gs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">uend_mssdc_gs</span> <span class="o">-</span> <span class="n">uend_mssdc_jac</span><span class="p">)</span>

    <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/step_8_B_out.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Error PFASST: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_pfasst</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Error parallel MSSDC: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_mssdc_jac</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Error serial MSSDC: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err_mssdc_gs</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Diff PFASST vs. parallel MSSDC: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">diff_jac</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Diff PFASST vs. serial MSSDC: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">diff_gs</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Diff parallel vs. serial MSSDC: </span><span class="si">%12.8e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">diff_jac_gs</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="c1"># convert filtered statistics to list of iterations count, sorted by process</span>
    <span class="n">iter_counts_pfasst</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats_pfasst</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">iter_counts_mssdc_jac</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats_mssdc_jac</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">iter_counts_mssdc_gs</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats_mssdc_gs</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># compute and print statistics</span>
    <span class="k">for</span> <span class="n">item_pfasst</span><span class="p">,</span> <span class="n">item_mssdc_jac</span><span class="p">,</span> <span class="n">item_mssdc_gs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">iter_counts_pfasst</span><span class="p">,</span> <span class="n">iter_counts_mssdc_jac</span><span class="p">,</span> <span class="n">iter_counts_mssdc_gs</span>
    <span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Number of iterations for time </span><span class="si">%4.2f</span><span class="s1"> (PFASST/parMSSDC/serMSSDC): </span><span class="si">%2i</span><span class="s1"> / </span><span class="si">%2i</span><span class="s1"> / </span><span class="si">%2i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">item_pfasst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">item_pfasst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">item_mssdc_jac</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">item_mssdc_gs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># call helper routine to produce residual plot</span>
    <span class="n">show_residual_across_simulation</span><span class="p">(</span><span class="n">stats_mssdc_jac</span><span class="p">,</span> <span class="s1">&#39;data/step_8_residuals_mssdc_jac.png&#39;</span><span class="p">)</span>
    <span class="n">show_residual_across_simulation</span><span class="p">(</span><span class="n">stats_mssdc_gs</span><span class="p">,</span> <span class="s1">&#39;data/step_8_residuals_mssdc_gs.png&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;data/step_8_residuals_mssdc_jac.png&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;data/step_8_residuals_mssdc_gs.png&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">diff_jac</span> <span class="o">&lt;</span> <span class="mf">3.1e-10</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;ERROR: difference between PFASST and parallel MSSDC controller is too large, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">diff_jac</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">diff_gs</span> <span class="o">&lt;</span> <span class="mf">3.1e-10</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;ERROR: difference between PFASST and serial MSSDC controller is too large, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">diff_gs</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">diff_jac_gs</span> <span class="o">&lt;</span> <span class="mf">3.1e-10</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;ERROR: difference between parallel and serial MSSDC controller is too large, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">diff_jac_gs</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">PFASST</span><span class="p">:</span> <span class="mf">2.87344391e-07</span>
<span class="n">Error</span> <span class="n">parallel</span> <span class="n">MSSDC</span><span class="p">:</span> <span class="mf">2.87650037e-07</span>
<span class="n">Error</span> <span class="n">serial</span> <span class="n">MSSDC</span><span class="p">:</span> <span class="mf">2.87540078e-07</span>
<span class="n">Diff</span> <span class="n">PFASST</span> <span class="n">vs</span><span class="o">.</span> <span class="n">parallel</span> <span class="n">MSSDC</span><span class="p">:</span> <span class="mf">3.05646515e-10</span>
<span class="n">Diff</span> <span class="n">PFASST</span> <span class="n">vs</span><span class="o">.</span> <span class="n">serial</span> <span class="n">MSSDC</span><span class="p">:</span> <span class="mf">1.95687314e-10</span>
<span class="n">Diff</span> <span class="n">parallel</span> <span class="n">vs</span><span class="o">.</span> <span class="n">serial</span> <span class="n">MSSDC</span><span class="p">:</span> <span class="mf">1.09959201e-10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.00</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">5</span> <span class="o">/</span>  <span class="mi">8</span> <span class="o">/</span>  <span class="mi">8</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.12</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">5</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">/</span>  <span class="mi">9</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.25</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">6</span> <span class="o">/</span> <span class="mi">11</span> <span class="o">/</span>  <span class="mi">9</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.38</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">6</span> <span class="o">/</span> <span class="mi">13</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.50</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">7</span> <span class="o">/</span> <span class="mi">14</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.62</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">7</span> <span class="o">/</span> <span class="mi">15</span> <span class="o">/</span> <span class="mi">11</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.75</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">8</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">/</span> <span class="mi">11</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="k">for</span> <span class="n">time</span> <span class="mf">0.88</span> <span class="p">(</span><span class="n">PFASST</span><span class="o">/</span><span class="n">parMSSDC</span><span class="o">/</span><span class="n">serMSSDC</span><span class="p">):</span>  <span class="mi">8</span> <span class="o">/</span> <span class="mi">18</span> <span class="o">/</span> <span class="mi">11</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/step_8_residuals_mssdc_jac.png"><img alt="../_images/step_8_residuals_mssdc_jac.png" src="../_images/step_8_residuals_mssdc_jac.png" style="width: 754.0px; height: 505.5px;" />
</a>
<a class="reference internal image-reference" href="../_images/step_8_residuals_mssdc_gs.png"><img alt="../_images/step_8_residuals_mssdc_gs.png" src="../_images/step_8_residuals_mssdc_gs.png" style="width: 754.0px; height: 505.5px;" />
</a>
</section>
<section id="part-c-iteration-estimator">
<h2>Part C: Iteration estimator<a class="headerlink" href="#part-c-iteration-estimator" title="Link to this heading">¶</a></h2>
<p>One may ask when to stop the SDC, MLSDC, PFASST iterations. So far, we have used a residual threshold or a fixed number of iterations to stop the process.
Another option is to estimate the number of iterations it takes to reach a given error w.r.t. the exact collocation solution.
This can be done by using two consecutive iterates to estimate the Lipschitz constant of the iteration procedure.
Adding a few magic/safety constants here and there and you can guess when to stop.
This example takes three different test cases and checks how well the iteration estimator drives the iterates below the threshold.</p>
<p>Important things to note:</p>
<ul class="simple">
<li><p>The estimator also works for PFASST, where is ensures that up to each step (!) the tolerance is met.</p></li>
<li><p>The method also works for the parallel <cite>controller_MPI</cite> controller by using interrupts for checking when to stop (not tested here).</p></li>
</ul>
<p>Full code: <a class="reference external" href="https://github.com/Parallel-in-Time/pySDC/blob/master/pySDC/tutorial/step_8/C_iteration_estimator.py">pySDC/tutorial/step_8/C_iteration_estimator.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.helpers.stats_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sorted</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.controller_classes.controller_nonMPI</span><span class="w"> </span><span class="kn">import</span> <span class="n">controller_nonMPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.HeatEquation_ND_FD</span><span class="w"> </span><span class="kn">import</span> <span class="n">heatNd_forced</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.AdvectionEquation_ND_FD</span><span class="w"> </span><span class="kn">import</span> <span class="n">advectionNd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.problem_classes.Auzinger_implicit</span><span class="w"> </span><span class="kn">import</span> <span class="n">auzinger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.sweeper_classes.imex_1st_order</span><span class="w"> </span><span class="kn">import</span> <span class="n">imex_1st_order</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.sweeper_classes.generic_implicit</span><span class="w"> </span><span class="kn">import</span> <span class="n">generic_implicit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.transfer_classes.TransferMesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">mesh_to_mesh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.transfer_classes.TransferMesh_NoCoarse</span><span class="w"> </span><span class="kn">import</span> <span class="n">mesh_to_mesh</span> <span class="k">as</span> <span class="n">mesh_to_mesh_nc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.implementations.convergence_controller_classes.check_iteration_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">CheckIterationEstimatorNonMPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pySDC.tutorial.step_8.HookClass_error_output</span><span class="w"> </span><span class="kn">import</span> <span class="n">error_output</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup_diffusion</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ml</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span>  <span class="c1"># time-step size</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LU&#39;</span><span class="p">]</span>  <span class="c1"># For the IMEX sweeper, the LU-trick can be activated for the implicit part</span>
    <span class="c1"># sweeper_params[&#39;initial_guess&#39;] = &#39;zero&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># order of accuracy for FD discretization in space</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># diffusion coefficient</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;periodic&#39;</span>  <span class="c1"># boundary conditions</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="mi">2</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">))</span>  <span class="c1"># frequencies</span>
    <span class="k">if</span> <span class="n">ml</span><span class="p">:</span>
        <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="mi">64</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">)),</span> <span class="nb">tuple</span><span class="p">(</span><span class="mi">32</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">))]</span>  <span class="c1"># number of dofs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="mi">64</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">))</span>  <span class="c1"># number of dofs</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;solver_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CG&#39;</span>  <span class="c1"># do CG instead of LU</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;liniter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># number of CG iterations</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;errtol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-07</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># setup the iteration estimator</span>
    <span class="n">convergence_controllers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">convergence_controllers</span><span class="p">[</span><span class="n">CheckIterationEstimatorNonMPI</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">}</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;hook_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_output</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heatNd_forced</span>  <span class="c1"># pass problem class</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">imex_1st_order</span>  <span class="c1"># pass sweeper (see part B)</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;convergence_controllers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convergence_controllers</span>
    <span class="k">if</span> <span class="n">ml</span><span class="p">:</span>
        <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>  <span class="c1"># pass spatial transfer class</span>
        <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>  <span class="c1"># pass parameters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup_advection</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ml</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span>  <span class="c1"># time-step size</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LU&#39;</span><span class="p">]</span>  <span class="c1"># For the IMEX sweeper, the LU-trick can be activated for the implicit part</span>
    <span class="c1"># sweeper_params[&#39;initial_guess&#39;] = &#39;zero&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># order of accuracy for FD discretization in space</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;stencil_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>  <span class="c1"># order of accuracy for FD discretization in space</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;periodic&#39;</span>  <span class="c1"># boundary conditions</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># diffusion coefficient</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="mi">2</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">))</span>  <span class="c1"># frequencies</span>
    <span class="k">if</span> <span class="n">ml</span><span class="p">:</span>
        <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="mi">64</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">)),</span> <span class="nb">tuple</span><span class="p">(</span><span class="mi">32</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">))]</span>  <span class="c1"># number of dofs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;nvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="mi">64</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">))</span>  <span class="c1"># number of dofs</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;solver_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GMRES&#39;</span>  <span class="c1"># do GMRES instead of LU</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;liniter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># number of GMRES iterations</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;errtol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-07</span>

    <span class="c1"># initialize space transfer parameters</span>
    <span class="n">space_transfer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;rorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;iorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">space_transfer_params</span><span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># setup the iteration estimator</span>
    <span class="n">convergence_controllers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">convergence_controllers</span><span class="p">[</span><span class="n">CheckIterationEstimatorNonMPI</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">}</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;hook_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_output</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">advectionNd</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;convergence_controllers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convergence_controllers</span>
    <span class="k">if</span> <span class="n">ml</span><span class="p">:</span>
        <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh</span>  <span class="c1"># pass spatial transfer class</span>
        <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">space_transfer_params</span>  <span class="c1"># pass parameters for spatial transfer</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup_auzinger</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ml</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># initialize level parameters</span>
    <span class="n">level_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;restol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span>  <span class="c1"># time-step size</span>
    <span class="n">level_params</span><span class="p">[</span><span class="s1">&#39;nsweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># initialize sweeper parameters</span>
    <span class="n">sweeper_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;quad_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RADAU-RIGHT&#39;</span>
    <span class="k">if</span> <span class="n">ml</span><span class="p">:</span>
        <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">sweeper_params</span><span class="p">[</span><span class="s1">&#39;QI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LU&#39;</span><span class="p">]</span>  <span class="c1"># For the IMEX sweeper, the LU-trick can be activated for the implicit part</span>
    <span class="c1"># sweeper_params[&#39;initial_guess&#39;] = &#39;zero&#39;</span>

    <span class="c1"># initialize problem parameters</span>
    <span class="n">problem_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;newton_tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-12</span>
    <span class="n">problem_params</span><span class="p">[</span><span class="s1">&#39;newton_maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># initialize step parameters</span>
    <span class="n">step_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">step_params</span><span class="p">[</span><span class="s1">&#39;errtol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-07</span>

    <span class="c1"># setup the iteration estimator</span>
    <span class="n">convergence_controllers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">convergence_controllers</span><span class="p">[</span><span class="n">CheckIterationEstimatorNonMPI</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">}</span>

    <span class="c1"># initialize controller parameters</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;logger_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">controller_params</span><span class="p">[</span><span class="s1">&#39;hook_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_output</span>

    <span class="c1"># fill description dictionary for easy step instantiation</span>
    <span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auzinger</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;problem_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">problem_params</span>  <span class="c1"># pass problem parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generic_implicit</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;sweeper_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sweeper_params</span>  <span class="c1"># pass sweeper parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;level_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_params</span>  <span class="c1"># pass level parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_params</span>  <span class="c1"># pass step parameters</span>
    <span class="n">description</span><span class="p">[</span><span class="s1">&#39;convergence_controllers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convergence_controllers</span>
    <span class="k">if</span> <span class="n">ml</span><span class="p">:</span>
        <span class="n">description</span><span class="p">[</span><span class="s1">&#39;space_transfer_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_to_mesh_nc</span>  <span class="c1"># pass spatial transfer class</span>

    <span class="k">return</span> <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">run_simulations</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nsteps_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ml</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nprocs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple test program to do SDC runs for the heat equation in various dimensions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">controller_params</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/step_8_C_out.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ndim</span> <span class="ow">in</span> <span class="n">ndim_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">nsteps</span> <span class="ow">in</span> <span class="n">nsteps_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;diffusion&#39;</span><span class="p">:</span>
                <span class="c1"># set time parameters</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tend</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="n">nsteps</span>
                <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">setup_diffusion</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">ml</span><span class="p">)</span>
                <span class="n">mean_number_of_iterations</span> <span class="o">=</span> <span class="mf">3.00</span> <span class="k">if</span> <span class="n">ml</span> <span class="k">else</span> <span class="mf">5.75</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;advection&#39;</span><span class="p">:</span>
                <span class="c1"># set time parameters</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tend</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="n">nsteps</span>
                <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">setup_advection</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">ml</span><span class="p">)</span>
                <span class="n">mean_number_of_iterations</span> <span class="o">=</span> <span class="mf">2.00</span> <span class="k">if</span> <span class="n">ml</span> <span class="k">else</span> <span class="mf">4.00</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;auzinger&#39;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="c1"># set time parameters</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tend</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="n">nsteps</span>
                <span class="n">description</span><span class="p">,</span> <span class="n">controller_params</span> <span class="o">=</span> <span class="n">setup_auzinger</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">ml</span><span class="p">)</span>
                <span class="n">mean_number_of_iterations</span> <span class="o">=</span> <span class="mf">3.62</span> <span class="k">if</span> <span class="n">ml</span> <span class="k">else</span> <span class="mf">5.62</span>

            <span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Running </span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> dimensions with time-step size </span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s1">...</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

            <span class="c1"># Warning: this is black magic used to run an &#39;exact&#39; collocation solver for each step within the hooks</span>
            <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
            <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">][</span><span class="s1">&#39;controller_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">controller_params</span>

            <span class="c1"># instantiate controller</span>
            <span class="n">controller</span> <span class="o">=</span> <span class="n">controller_nonMPI</span><span class="p">(</span>
                <span class="n">num_procs</span><span class="o">=</span><span class="n">nprocs</span><span class="p">,</span> <span class="n">controller_params</span><span class="o">=</span><span class="n">controller_params</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span>
            <span class="p">)</span>

            <span class="c1"># get initial values on finest level</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
            <span class="n">uinit</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>

            <span class="c1"># call main function to get things done...</span>
            <span class="n">uend</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">uinit</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">Tend</span><span class="o">=</span><span class="n">Tend</span><span class="p">)</span>

            <span class="c1"># filter statistics by type (number of iterations)</span>
            <span class="n">iter_counts</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;niter&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

            <span class="n">niters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_counts</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;   Mean number of iterations: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">niters</span><span class="p">)</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

            <span class="c1"># filter statistics by type (error after time-step)</span>
            <span class="n">PDE_errors</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;PDE_error_after_step&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="n">coll_errors</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;coll_error_after_step&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iters</span><span class="p">,</span> <span class="n">PDE_err</span><span class="p">,</span> <span class="n">coll_err</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iter_counts</span><span class="p">,</span> <span class="n">PDE_errors</span><span class="p">,</span> <span class="n">coll_errors</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">coll_err</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">description</span><span class="p">[</span><span class="s1">&#39;step_params&#39;</span><span class="p">][</span><span class="s1">&#39;errtol&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;Error too high, got </span><span class="si">{</span><span class="n">coll_err</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">8.4e</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">out</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;   Errors after step </span><span class="si">{</span><span class="n">PDE_err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">8.4f</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">iters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> iterations: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PDE_err</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">8.4e</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">coll_err</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">8.4e</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

            <span class="c1"># filter statistics by type (error after time-step)</span>
            <span class="n">timing</span> <span class="o">=</span> <span class="n">get_sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;timing_run&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;...done, took </span><span class="si">{</span><span class="n">timing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> seconds!&#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;-----------------------------------------------------------------------------&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
        <span class="n">mean_number_of_iterations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">niters</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-2</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Expected </span><span class="se">\</span>
<span class="si">{</span><span class="n">mean_number_of_iterations</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> mean iterations, but got </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">niters</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">run_simulations</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;diffusion&#39;</span><span class="p">,</span> <span class="n">ndim_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tend</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nsteps_list</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ml</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nprocs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">run_simulations</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;diffusion&#39;</span><span class="p">,</span> <span class="n">ndim_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tend</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nsteps_list</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nprocs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">run_simulations</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;advection&#39;</span><span class="p">,</span> <span class="n">ndim_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tend</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nsteps_list</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ml</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nprocs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">run_simulations</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;advection&#39;</span><span class="p">,</span> <span class="n">ndim_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tend</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nsteps_list</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nprocs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">run_simulations</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;auzinger&#39;</span><span class="p">,</span> <span class="n">ndim_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tend</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nsteps_list</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ml</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nprocs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">run_simulations</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;auzinger&#39;</span><span class="p">,</span> <span class="n">ndim_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tend</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nsteps_list</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nprocs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Running diffusion in 1 dimensions with time-step size 0.125...

   Mean number of iterations: 5.75
   Errors after step   0.1250 with 5 iterations: 1.7804e-08 / 3.4661e-13
   Errors after step   0.2500 with 5 iterations: 4.9619e-08 / 2.8075e-13
   Errors after step   0.3750 with 6 iterations: 4.2300e-08 / 3.0376e-13
   Errors after step   0.5000 with 6 iterations: 3.8684e-08 / 2.6490e-13
   Errors after step   0.6250 with 6 iterations: 3.7128e-08 / 2.8078e-13
   Errors after step   0.7500 with 6 iterations: 3.6619e-08 / 1.5365e-13
   Errors after step   0.8750 with 6 iterations: 3.6530e-08 / 2.0645e-13
   Errors after step   1.0000 with 6 iterations: 3.6478e-08 / 1.2759e-13

...done, took 0.33572562500000913 seconds!
-----------------------------------------------------------------------------
Running diffusion in 1 dimensions with time-step size 0.125...

   Mean number of iterations: 3.00
   Errors after step   0.1250 with 3 iterations: 9.8191e-09 / 3.3584e-13
   Errors after step   0.2500 with 3 iterations: 1.7174e-08 / 5.0504e-13
   Errors after step   0.3750 with 3 iterations: 2.2849e-08 / 5.9697e-13
   Errors after step   0.5000 with 3 iterations: 2.7307e-08 / 5.6494e-13
   Errors after step   0.6250 with 3 iterations: 3.0813e-08 / 5.0748e-13
   Errors after step   0.7500 with 3 iterations: 3.3516e-08 / 4.7096e-13
   Errors after step   0.8750 with 3 iterations: 3.5501e-08 / 3.9957e-13
   Errors after step   1.0000 with 3 iterations: 3.6813e-08 / 1.6975e-13

...done, took 0.7602929539999934 seconds!
-----------------------------------------------------------------------------
Running advection in 1 dimensions with time-step size 0.125...

   Mean number of iterations: 4.00
   Errors after step   0.1250 with 4 iterations: 3.6459e-09 / 5.5511e-16
   Errors after step   0.2500 with 4 iterations: 7.2907e-09 / 4.4409e-16
   Errors after step   0.3750 with 4 iterations: 1.0930e-08 / 3.3307e-16
   Errors after step   0.5000 with 4 iterations: 1.4571e-08 / 4.4409e-16
   Errors after step   0.6250 with 4 iterations: 1.8225e-08 / 4.4409e-16
   Errors after step   0.7500 with 4 iterations: 2.1875e-08 / 4.4409e-16
   Errors after step   0.8750 with 4 iterations: 2.5517e-08 / 3.3307e-16
   Errors after step   1.0000 with 4 iterations: 2.9147e-08 / 4.4409e-16

...done, took 0.20358819000000494 seconds!
-----------------------------------------------------------------------------
Running advection in 1 dimensions with time-step size 0.125...

   Mean number of iterations: 2.00
   Errors after step   0.1250 with 2 iterations: 3.7050e-09 / 3.1841e-13
   Errors after step   0.2500 with 2 iterations: 7.4360e-09 / 3.1875e-13
   Errors after step   0.3750 with 2 iterations: 1.1141e-08 / 3.1852e-13
   Errors after step   0.5000 with 2 iterations: 1.4836e-08 / 3.1886e-13
   Errors after step   0.6250 with 2 iterations: 1.8580e-08 / 3.1852e-13
   Errors after step   0.7500 with 2 iterations: 2.2256e-08 / 3.1830e-13
   Errors after step   0.8750 with 2 iterations: 2.5987e-08 / 3.1841e-13
   Errors after step   1.0000 with 2 iterations: 2.9666e-08 / 3.1819e-13

...done, took 0.5925079810000113 seconds!
-----------------------------------------------------------------------------
Running auzinger in 1 dimensions with time-step size 0.125...

   Mean number of iterations: 5.62
   Errors after step   0.1250 with 5 iterations: 4.6598e-09 / 0.0000e+00
   Errors after step   0.2500 with 5 iterations: 8.0010e-09 / 0.0000e+00
   Errors after step   0.3750 with 5 iterations: 1.4700e-08 / 0.0000e+00
   Errors after step   0.5000 with 6 iterations: 1.5583e-08 / 0.0000e+00
   Errors after step   0.6250 with 6 iterations: 2.1829e-08 / 0.0000e+00
   Errors after step   0.7500 with 6 iterations: 2.6153e-08 / 0.0000e+00
   Errors after step   0.8750 with 6 iterations: 2.8266e-08 / 0.0000e+00
   Errors after step   1.0000 with 6 iterations: 2.8338e-08 / 0.0000e+00

...done, took 0.13490748099999905 seconds!
-----------------------------------------------------------------------------
Running auzinger in 1 dimensions with time-step size 0.125...

   Mean number of iterations: 3.62
   Errors after step   0.1250 with 3 iterations: 4.2389e-09 / 0.0000e+00
   Errors after step   0.2500 with 3 iterations: 8.4469e-09 / 0.0000e+00
   Errors after step   0.3750 with 3 iterations: 1.1763e-08 / 0.0000e+00
   Errors after step   0.5000 with 4 iterations: 1.7832e-08 / 0.0000e+00
   Errors after step   0.6250 with 4 iterations: 2.3399e-08 / 0.0000e+00
   Errors after step   0.7500 with 4 iterations: 2.8017e-08 / 0.0000e+00
   Errors after step   0.8750 with 4 iterations: 3.1486e-08 / 0.0000e+00
   Errors after step   1.0000 with 4 iterations: 3.3802e-08 / 0.0000e+00

...done, took 0.1594592069999976 seconds!
-----------------------------------------------------------------------------
</pre></div>
</div>
</section>
<section id="part-x-to-be-continued">
<h2>Part X: To be continued…<a class="headerlink" href="#part-x-to-be-continued" title="Link to this heading">¶</a></h2>
<p>We shall see what comes next…</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Step-8: Advanced topics</a><ul>
<li><a class="reference internal" href="#part-a-visualizing-residuals">Part A: Visualizing Residuals</a></li>
<li><a class="reference internal" href="#part-b-multi-step-sdc">Part B: Multi-step SDC</a></li>
<li><a class="reference internal" href="#part-c-iteration-estimator">Part C: Iteration estimator</a></li>
<li><a class="reference internal" href="#part-x-to-be-continued">Part X: To be continued…</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="step_7.html"
                          title="previous chapter">Step-7: pySDC with external libraries</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../projects/parallelSDC.html"
                          title="next chapter">Attempts to parallelize SDC</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/step_8.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../projects/parallelSDC.html" title="Attempts to parallelize SDC"
             >next</a> |</li>
        <li class="right" >
          <a href="step_7.html" title="Step-7: pySDC with external libraries"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pySDC 5.6 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Step-8: Advanced topics</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Robert Speck.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>